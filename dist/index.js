var b=Object.defineProperty;var p=Object.getOwnPropertySymbols;var h=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var l=(o,e,t)=>e in o?b(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,u=(o,e)=>{for(var t in e||(e={}))h.call(e,t)&&l(o,t,e[t]);if(p)for(var t of p(e))P.call(e,t)&&l(o,t,e[t]);return o};var g=class extends Error{constructor(t,r,s){super(s||`API Error: ${t} ${r}`);this.status=t;this.statusText=r;this.name="InteractApiError"}},c=class{constructor(e={}){this.baseUrl=e.baseUrl||"https://unica.prod.hxun.aws.now.hclsoftware.cloud/interact/v2",this.defaultHeaders=u({"Content-Type":"application/json"},e.defaultHeaders),e.username&&(this.defaultHeaders.m_user_name=e.username),e.password&&(this.defaultHeaders.m_user_password=e.password)}async request(e,t,r={}){let s=new URL(t,this.baseUrl);r.params&&Object.entries(r.params).forEach(([d,O])=>{O!=null&&s.searchParams.append(d,String(O))});let n=u(u({},this.defaultHeaders),r.headers),i={method:e,headers:n};r.body&&e!=="GET"&&(i.body=JSON.stringify(r.body));let a=await fetch(s.toString(),i);if(!a.ok)throw new g(a.status,a.statusText);let m=a.headers.get("content-type");return m!=null&&m.includes("application/json")?a.json():a.text()}async startSession(e,t,r,s,n,i=!0){return this.request("POST",`/sessions/${e}`,{params:{ic:t,audienceLevel:r,audienceIDField:s,escapeHtml:i},body:n})}async endSession(e,t,r=!0){return this.request("DELETE",`/sessions/${e}`,{params:{parameters:t,escapeHtml:r}})}async setAudience(e,t,r,s,n=!0){return this.request("PUT",`/audiences/${e}`,{params:{audienceLevel:t,audienceIDField:r,escapeHtml:n},body:s})}async getOffers(e,t,r,s,n=!0){return this.request("GET",`/offers/${e}/${t}`,{params:{number:r,parameters:s,escapeHtml:n}})}async getOffersForMultipleIPs(e,t,r,s=!0){return this.request("POST",`/offers/${e}`,{params:{parameters:r,escapeHtml:s},body:t})}async postEvent(e,t,r,s=!0){return this.request("POST",`/events/${e}/${t}`,{params:{escapeHtml:s},body:r})}async getProfile(e,t,r=!0){return this.request("GET",`/profiles/${e}`,{params:{parameters:t,escapeHtml:r}})}async batchExecute(e,t,r=!0){return this.request("POST",`/batch/${e}`,{params:{escapeHtml:r},body:t})}async executeCompleteInteraction(e,t,r,s,n,i=1,a={}){let m={startSession:{ic:t,audienceLevel:r,audienceID:s,debug:a.debug,relyOnExistingSession:a.relyOnExistingSession,parameters:a.sessionParameters},getOffers:{interactionPointID:n,numberRequested:i,parameters:a.offerParameters},endSession:{}};return this.batchExecute(e,m)}async executeInteractionWithEvent(e,t,r,s,n,i,a=1,m={}){let d={startSession:{ic:t,audienceLevel:r,audienceID:s,debug:m.debug,parameters:m.sessionParameters},postEvent:{event:n,parameters:m.eventParameters},getOffers:{interactionPointID:i,numberRequested:a,parameters:m.offerParameters},endSession:{}};return this.batchExecute(e,d)}async executeMultiTouchpointInteraction(e,t,r,s,n,i={}){let a={startSession:{ic:t,audienceLevel:r,audienceID:s,debug:i.debug,parameters:i.sessionParameters},getOffersForMultipleInteractionPoints:{getOfferRequests:n,parameters:i.offerParameters},endSession:{}};return this.batchExecute(e,a)}async executeProfileBasedInteraction(e,t,r,s,n,i=1,a={}){let m={startSession:{ic:t,audienceLevel:r,audienceID:s,debug:a.debug,parameters:a.sessionParameters},getProfile:{},getOffers:{interactionPointID:n,numberRequested:i,parameters:a.offerParameters},endSession:{}};return this.batchExecute(e,m)}createBatchBuilder(e){return new f(this,e)}async getStatus(){return this.request("GET","/status")}async getResourceConsumption(){return this.request("GET","/resources")}async getActiveDeployments(){return this.request("GET","/deployments")}async getDeploymentByIcId(e){return this.request("GET",`/deployments/channels/${e}`)}async getDataSources(){return this.request("GET","/datasources")}async testDataSourceConnection(e){return this.request("GET","/datasources/status",{params:{datasourceName:e}})}async getGDPRSQLScripts(e,t,r,s){return this.request("POST","/gdpr",{params:{QuerySeparator:t,NLSPrefix:r,returnZip:s},body:e})}async syncConsent(){return this.request("POST","/consent/sync")}static createParameter(e,t,r){return{n:e,t,v:r}}static createParameters(e){return e.map(t=>this.createParameter(t.name,t.type,t.value))}};function x(o){return new c(o)}var f=class{constructor(e,t){this.client=e;this.sessionId=t;this.batchCommand={}}startSession(e,t,r,s={}){return this.batchCommand.startSession=u({ic:e,audienceLevel:t,audienceID:r},s),this}getOffers(e,t=1,r){return this.batchCommand.getOffers={interactionPointID:e,numberRequested:t,parameters:r},this}getOffersMultiple(e,t){return this.batchCommand.getOffersForMultipleInteractionPoints={getOfferRequests:e,parameters:t},this}postEvent(e,t){return this.batchCommand.postEvent={event:e,parameters:t},this}setAudience(e,t,r){return this.batchCommand.setAudience={audienceLevel:e,audienceID:t,parameters:r},this}getProfile(){return this.batchCommand.getProfile={},this}endSession(){return this.batchCommand.endSession={},this}setDebug(e){return this.batchCommand.setDebug={debug:e},this}getVersion(){return this.batchCommand.getVersion=!0,this}async execute(){return this.client.batchExecute(this.sessionId,this.batchCommand)}build(){return u({},this.batchCommand)}},R=c;export{f as BatchBuilder,c as InteractApiClient,g as InteractApiError,x as createInteractClient,R as default};
