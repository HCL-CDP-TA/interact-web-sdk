var d=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols;var h=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var b=(a,e,t)=>e in a?d(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,u=(a,e)=>{for(var t in e||(e={}))h.call(e,t)&&b(a,t,e[t]);if(l)for(var t of l(e))y.call(e,t)&&b(a,t,e[t]);return a};var S=(a,e)=>{for(var t in e)d(a,t,{get:e[t],enumerable:!0})},x=(a,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of V(e))!h.call(a,s)&&s!==t&&d(a,s,{get:()=>e[s],enumerable:!(r=P(e,s))||r.enumerable});return a};var R=a=>x(d({},"__esModule",{value:!0}),a);var B={};S(B,{BatchBuilder:()=>g,InteractApiClient:()=>c,InteractApiError:()=>O,createInteractClient:()=>C,default:()=>E});module.exports=R(B);var O=class extends Error{constructor(t,r,s){super(s||`API Error: ${t} ${r}`);this.status=t;this.statusText=r;this.name="InteractApiError"}},c=class{constructor(e={}){this.baseUrl=e.baseUrl||"https://unica.prod.hxun.aws.now.hclsoftware.cloud/interact/v2",this.defaultHeaders=u({"Content-Type":"application/json"},e.defaultHeaders),e.username&&(this.defaultHeaders.m_user_name=e.username),e.password&&(this.defaultHeaders.m_user_password=e.password)}async request(e,t,r={}){let s=new URL(t,this.baseUrl);r.params&&Object.entries(r.params).forEach(([f,p])=>{p!=null&&s.searchParams.append(f,String(p))});let i=u(u({},this.defaultHeaders),r.headers),o={method:e,headers:i};r.body&&e!=="GET"&&(o.body=JSON.stringify(r.body));let n=await fetch(s.toString(),o);if(!n.ok)throw new O(n.status,n.statusText);let m=n.headers.get("content-type");return m!=null&&m.includes("application/json")?n.json():n.text()}async startSession(e,t,r,s,i,o=!0){return this.request("POST",`/sessions/${e}`,{params:{ic:t,audienceLevel:r,audienceIDField:s,escapeHtml:o},body:i})}async endSession(e,t,r=!0){return this.request("DELETE",`/sessions/${e}`,{params:{parameters:t,escapeHtml:r}})}async setAudience(e,t,r,s,i=!0){return this.request("PUT",`/audiences/${e}`,{params:{audienceLevel:t,audienceIDField:r,escapeHtml:i},body:s})}async getOffers(e,t,r,s,i=!0){return this.request("GET",`/offers/${e}/${t}`,{params:{number:r,parameters:s,escapeHtml:i}})}async getOffersForMultipleIPs(e,t,r,s=!0){return this.request("POST",`/offers/${e}`,{params:{parameters:r,escapeHtml:s},body:t})}async postEvent(e,t,r,s=!0){return this.request("POST",`/events/${e}/${t}`,{params:{escapeHtml:s},body:r})}async getProfile(e,t,r=!0){return this.request("GET",`/profiles/${e}`,{params:{parameters:t,escapeHtml:r}})}async batchExecute(e,t,r=!0){return this.request("POST",`/batch/${e}`,{params:{escapeHtml:r},body:t})}async executeCompleteInteraction(e,t,r,s,i,o=1,n={}){let m={startSession:{ic:t,audienceLevel:r,audienceID:s,debug:n.debug,relyOnExistingSession:n.relyOnExistingSession,parameters:n.sessionParameters},getOffers:{interactionPointID:i,numberRequested:o,parameters:n.offerParameters},endSession:{}};return this.batchExecute(e,m)}async executeInteractionWithEvent(e,t,r,s,i,o,n=1,m={}){let f={startSession:{ic:t,audienceLevel:r,audienceID:s,debug:m.debug,parameters:m.sessionParameters},postEvent:{event:i,parameters:m.eventParameters},getOffers:{interactionPointID:o,numberRequested:n,parameters:m.offerParameters},endSession:{}};return this.batchExecute(e,f)}async executeMultiTouchpointInteraction(e,t,r,s,i,o={}){let n={startSession:{ic:t,audienceLevel:r,audienceID:s,debug:o.debug,parameters:o.sessionParameters},getOffersForMultipleInteractionPoints:{getOfferRequests:i,parameters:o.offerParameters},endSession:{}};return this.batchExecute(e,n)}async executeProfileBasedInteraction(e,t,r,s,i,o=1,n={}){let m={startSession:{ic:t,audienceLevel:r,audienceID:s,debug:n.debug,parameters:n.sessionParameters},getProfile:{},getOffers:{interactionPointID:i,numberRequested:o,parameters:n.offerParameters},endSession:{}};return this.batchExecute(e,m)}createBatchBuilder(e){return new g(this,e)}async getStatus(){return this.request("GET","/status")}async getResourceConsumption(){return this.request("GET","/resources")}async getActiveDeployments(){return this.request("GET","/deployments")}async getDeploymentByIcId(e){return this.request("GET",`/deployments/channels/${e}`)}async getDataSources(){return this.request("GET","/datasources")}async testDataSourceConnection(e){return this.request("GET","/datasources/status",{params:{datasourceName:e}})}async getGDPRSQLScripts(e,t,r,s){return this.request("POST","/gdpr",{params:{QuerySeparator:t,NLSPrefix:r,returnZip:s},body:e})}async syncConsent(){return this.request("POST","/consent/sync")}static createParameter(e,t,r){return{n:e,t,v:r}}static createParameters(e){return e.map(t=>this.createParameter(t.name,t.type,t.value))}};function C(a){return new c(a)}var g=class{constructor(e,t){this.client=e;this.sessionId=t;this.batchCommand={}}startSession(e,t,r,s={}){return this.batchCommand.startSession=u({ic:e,audienceLevel:t,audienceID:r},s),this}getOffers(e,t=1,r){return this.batchCommand.getOffers={interactionPointID:e,numberRequested:t,parameters:r},this}getOffersMultiple(e,t){return this.batchCommand.getOffersForMultipleInteractionPoints={getOfferRequests:e,parameters:t},this}postEvent(e,t){return this.batchCommand.postEvent={event:e,parameters:t},this}setAudience(e,t,r){return this.batchCommand.setAudience={audienceLevel:e,audienceID:t,parameters:r},this}getProfile(){return this.batchCommand.getProfile={},this}endSession(){return this.batchCommand.endSession={},this}setDebug(e){return this.batchCommand.setDebug={debug:e},this}getVersion(){return this.batchCommand.getVersion=!0,this}async execute(){return this.client.batchExecute(this.sessionId,this.batchCommand)}build(){return u({},this.batchCommand)}},E=c;0&&(module.exports={BatchBuilder,InteractApiClient,InteractApiError,createInteractClient});
